<div align="right">
부스트캠프 웹・모바일 9기 멤버십 Android : And04_project
</div>

# 🍀 Nature Album 🍀

주변의 생물을 촬영하고 식별하여 나만의 생물 도감을 만들고, 생물 지도를 친구들과 공유할 수 있는 앱 서비스

<img src="https://github.com/user-attachments/assets/5dca1733-a3dc-4a2f-bca3-094cd8bb2010" alt="Nature Album 배너 이미지" width="100%">

<br>

## ⭐ 프로젝트 소개

- 주변 생물을 촬영해 도감에 등록할 수 있습니다.
- 생물 도감 뿐만아니라 생물 지도에도 등록됩니다.
- 비회원으로 네트워크 없이 어디서든 생물을 촬영해 나만의 생물 도감을 만들어보세요~!
- 추가로 로그인을 하면 친구들의 생물 지도를 함께 볼 수 있답니다 😉 함께 즐겨보시는 것도 추천드립니다.

<br>

## ✨ 서비스 기능 소개

- 📸 생물 촬영 : 카메라로 주변의 생물 촬영
- 🖼️ 생물 도감 등록 : 라벨링하여 도감에 저장 및 도감 확인
- 🗺️ 생물 지도 확인 : 생물 도감의 위치 별로 표시되는 지도 확인
- 🤼 친구의 생물 지도 보기 : 로그인 하여 친구 추가한 친구들의 생물 지도 함께 보기

<br>

---
## ✨ 상세 기능 요약

![04  구조](https://github.com/user-attachments/assets/646c79fa-180d-490f-b212-cfe8989c06b1)

<br>

## ✨ 상세 기능

<video src="https://github.com/user-attachments/assets/c591e4e1-0a63-4d1f-857b-50beb7c6ad98" width="100%" controls></video>

<details>
<summary>도감 등록</summary>
<div>
  
|카메라 권한|촬영 & AI 라벨링|
|:---:|:---:|
|![permigif](https://github.com/user-attachments/assets/fc55df84-efea-47c3-9647-b2f10c959f26)|![aigif](https://github.com/user-attachments/assets/c121c79a-6e66-4e44-95f7-d5d593b913e4)|

</div>
</details>


<details>
<summary>도감 보기</summary>
<div>
  
|도감 상세보기|도감 이미지 앨범에 저장|도감 이미지 삭제|
|:---:|:---:|:---:|
|![도감 상세보기](https://github.com/user-attachments/assets/90936815-39ac-4d46-94af-3750b341b689)|![앨범에 저장](https://github.com/user-attachments/assets/4a7e4da9-6430-45ec-8382-916c204c6422)|![도감 삭제](https://github.com/user-attachments/assets/1c17ac07-33c7-4532-b094-9b209b764361)|

</div>
</details>

<details>
<summary>지도</summary>
<div>
  
|내 지도 보기|친구 지도 보기|네트워크 연결 확인|
|:---:|:---:|:---:|
|![내 지도 보기](https://github.com/user-attachments/assets/b3ecf90c-7074-4efa-b088-96fd5b36f6da)|![친구 지도 보기](https://github.com/user-attachments/assets/3ee94f22-c420-4434-a7b3-74b1b881bf2c)|![네트워크 연결 확인](https://github.com/user-attachments/assets/76fc1329-e8b0-450a-91fe-9f19c6d1f0dd)|

</div>
</details>

<details>
<summary>마이페이지 로그인 및 네트워크 연결 처리</summary>
<div>
  
|로그인|네트워크 마이페이지|동기화|
|:---:|:---:|:---:|
|![로그인](https://github.com/user-attachments/assets/05163740-b303-44d7-a317-79b7c47793ad)|![네트워크 마이페이지](https://github.com/user-attachments/assets/98a818fc-141f-485d-ae65-10befbf2d9c0)|![동기화](https://github.com/user-attachments/assets/3a37288e-9834-4f98-942f-111981f52a23)|

</div>
</details>

<details>
<summary>마이페이지 친구 기능</summary>
<div>
  
|친구 목록| 친구 검색과 네트워크 대응 | 
|:---:|:---:|
| ![1  친구 목록](https://github.com/user-attachments/assets/a243238b-84c9-454d-9b73-1afe70eafe62) | ![2  친구 검색 네트워크 포함](https://github.com/user-attachments/assets/501fb48d-05e1-44ae-9256-72419a8b786f) |  
| 친구 요청 거절과 수락 | foreground 친구 요청 알림|
|![3-4  친구 요청 거절과 수락](https://github.com/user-attachments/assets/e6cfd780-aeb3-4731-9d3e-a71ef83e5422) | ![3-1  친구 요청 포그라운드](https://github.com/user-attachments/assets/1b7f34de-de9b-42a1-adb3-395fc9082b47)|
 | background 친구 요청 알림 | 앱 종료 상태일 때 친구 요청 알림 |
 | ![3-2  친구 요청 백그라운드](https://github.com/user-attachments/assets/f41f5745-abba-455c-8a93-3eb9ad2642a9) | ![3-3  친구 요청 앱 종료](https://github.com/user-attachments/assets/8587294b-8003-44f2-bb23-bf78ffb6b6d1) | |

</div>
</details>

<br>

---

## 💫 서비스 구조

![04  구조](https://github.com/user-attachments/assets/aa64e72c-2f8b-4f85-921d-544bda283487)

<br>

## ✨ 기술 스택

| *분야* | *기술 스택* |
| --- | --- |
| **OS** | `Android` |
| **Launguage** | `Kotlin` |
| **UI** | `Compose` |
| **Network** | `Retrofit` |
| **Asynchronous** | `Coroutine`, `Flow` |
| **image** | `Coil` |
| **DI** | `Hilt` |
| **Background** | `WorkManager` |
| **Database** | `Room`, `FireStore` |
| **Map** | `Naver Map` |
| **Firebase** | `Firebase Storage`, `Firebase Cloud Messaging`, `Cloud Functions` |
| **AI** | `Gemini`, `Green-Eye` |
| **Tooling** | `Notion`, `Figma`, `Figjam`, `Github`, `Git`, `Zep` |

<br>

---

## 🔑 핵심 경험
### 1. 동기화
<img src="https://github.com/user-attachments/assets/8e74fe51-8a36-44aa-a3ad-56803f457b35" width="100%">

#### 🔍 **문제 상황**
동기화는 로그인 상태에서 매일 자정에 WIFI 연결 상태에서만 실행이 됩니다.   
동기화가 필요한 상황은 다음과 같습니다.   
> 1. 비회원으로 사용하다 로그인하는 경우
> 2. 네트워크 없이 사용하여 서버와 로컬의 데이터가 상이한 경우
> 3. 앱을 재설치하거나 앱 데이터를 삭제하여 로컬 데이터가 날아간 경우
> 4. 네트워크가 없는 상태에서 도감을 삭제 또는 추가한 경우

#### 🚀 **해결 과정**
따라서 서버와 로컬의 데이터를 모두 가져와 비교하여 서버에 필요한 데이터, 로컬에 필요한 데이터, 상이한 데이터로 분류한 뒤 저장 및 수정이 이루어지도록 구현하였습니다.   

#### ⚠️ **문제점**
- 모두 가져와 비교하기 때문에 데이터가 많아지면 그만큼 오래걸리게 됩니다.
- 또한 지금은 `서버에 필요한 데이터`, `로컬에 필요한 데이터`, `상이한 데이터` 세 가지 모두 각각 탐색하여 추출하기 때문에 효율에 대한 문제가 있습니다. 

#### 🌟 **개선 방안**

1. 탐색 방법 최적화
- 현재 탐색 방법을 Filter와 none, any 확장 함수를 사용하고 있는데 이는 for문으로 하나씩 탐색하는 방법으로 한 번 탐색할 때마다 O(N)의 시간 복잡도가 소요됩니다.   
- 따라서 이진 탐색으로 탐색하여 탐색 시간을 줄이는 방법을 사용 >> 다만 현재 데이터 리스트는 각각의 객체 타입으로 이루어져 있어 이를 어떻게 이진 탐색으로 구현할 지 고민이 필요합니다.
  
2. Local DB 속성 추가
- 서비스의 특성상 서버는 로컬 데이터의 변화를 파악하기 어렵지만 로컬은 서버에 저장 된 데이터를 파악할 수 있습니다. Local DB에 서버 저장 유무에 대한 속성을 추가하여 미등록 된 데이터만 가져와 비교하는 방법으로 시간 단축을 기대할 수 있습니다.
  
3. 한 번의 탐색으로 데이터 분류
- 한 번의 탐색으로 `서버에 필요한 데이터`, `로컬에 필요한 데이터`, `상이한 데이터`를 추출, 현재 같은 탐색을 3번 반복하여 서로 다른 데이터를 추출하고 있는데 이를 한 번에 3가지의 데이터를 추출하여 시간 단축을 기대할 수 있습니다.

---

### 2. Recomposition 최적화
<img src="https://github.com/user-attachments/assets/970c860e-befb-4c64-a69d-005ead29d5b4" width="100%">

기존 하위 컴포저블이 가진 상태를 호이스팅함으로써 공유하고 재사용 가능한 stateless한 컴포저블로 만들었습니다.

호이스팅된 상태를 하위 컴포저블에게 주기 위해 `by remember`를 사용하여 바로 값에 접근하여 값 자체를 상태를 필요로하는 컴포저블에게 넘겨주었습니다.

#### 🔍 **문제 상황**
하지만 위 이미지처럼 `by remember` 를 통해 값 자체를 넘겨줄 때 상태를 끌어올린 위치까지 전부 리컴포지션이 되는 문제가 발생했습니다.

하지만 반대로 `= remember` 를 사용해 `State` 타입을 넘겨주었을 땐, 실제 상태를 이용하는 컴포저블만 리컴포지션이 발생했습니다.

#### 🚀 **원인과 해결 과정**
두 선언 방식은 어떤 차이가 있길래 리컴포지션 측면에서 전혀 다른 결과가 발생했는지 알아보기 위해 들어간 내부 코드의 설명에서 정답을 찾을 수 있었습니다.

내부 코드에서는 아래와 같은 설명을 통해 안내하고 있었습니다.

> A mutable value holder where reads to the value property during the execution of a Composable function, the current RecomposeScope will be subscribed to changes of that value.
>
> When the value property is written to and changed, a recomposition of any subscribed RecomposeScopes will be scheduled.


컴포저블 함수가 실행되는 동안 `.value(getValue)` 를 읽으면 현재 실행중인 컴포저블은 해당 상태의 변경사항을 구독(subscribed)한다.

`value` 속성이 작성되고 변경되면 해당 상태를 구독한 컴포지션은 리컴포지션의 대상이된다.

<br>

즉, 상위 컴포저블에서 `by remember` 를 통해 값에 접근할 때는 내부적으로 `getValue` 를 통해 `value` 속성에 접근했기에 리컴포지션이 대상이 되었던 것이고, `= remember`를 사용하여 `State` 타입을 넘겨주었을 때는 `value` 속성에 접근한 것이 아니기에 리컴포지션 대상이 되지 않았던 것이었습니다.

#### ✅ **결과**

따라서, 상태를 끌어올린 위치의 컴포저블에서는 `= remember` 를 사용하고, 상태를 필요로하는 하위 컴포저블까지 `State` 타입을 넘겨주는 것으로 리컴포지션 최적화를 할 수 있었습니다.

<br>

---

### 3. FCM 구현: 백엔드 문제 해결
<img src="https://github.com/user-attachments/assets/99bc90fb-3e43-4c6c-96a8-2e34f169d2c0" width="100%">

#### 🔍 **문제 상황**
FCM(Firebase Cloud Messaging)으로 친구 요청 알림을 구현하려 했으나, 서버가 필요했고, 팀에 백엔드 개발자가 없는 상황이었다.

#### 🚀 **해결 과정**
1. **Firebase Cloud Functions 활용**  
   - Spring 서버 대신 Firebase Cloud Functions로 서버 역할 대체.  
   - Firestore 트리거(onCreate)를 활용해 친구 요청 문서 생성 시 FCM 알림 전송 로직 구현.  
2. **문제 해결**  
   - Firebase 설정 오류를 해결하며, 백그라운드 및 종료 상태에서도 정상 작동 확인.

#### ✅ **결과**
- Firebase Functions와 Firestore 트리거를 통해 친구 요청 알림 자동 전송 성공.  
- 백엔드 학습을 통해 클라이언트 개발자로서 기술적 한계를 극복.  

#### 🌟 **배운 점 및 성장**
- **기술 경계를 넘는 태도**: 백엔드 문제를 직접 해결하며 도전 정신과 문제 해결 능력을 키움.  
- **기술 확장 경험**: Firebase Cloud Functions와 Firestore 트리거를 활용해 클라이언트-서버 연동 이해도 향상.  

---

### 4. MapView와 Coil 이미지 로딩 및 Compose-View 라이프사이클 관리
<img src="https://github.com/user-attachments/assets/1cfdc52e-83f6-4a9c-bb08-ed659babcfc9" width="100%">

#### 🔍 **문제 상황**
1. Marker의 아이콘을 뷰로 생성할때 attach를 하지 않고 바로 비트맵으로 변환해서 내부의 이미지 비동기 로딩이 동작하지 않음.
2. Compose에서 MapView의 라이프사이클을 관리해야함.

#### 🚀 **해결 과정**
1. **Marker - Coil 이미지 로드**  
   - 마커의 아이콘으로 사용할 커스텀 뷰 제작.  
   - 커스텀 뷰에 uri를 설정하는 메소드를 추가해 coil로 이미지 로드.  
   - 마커를 invisible인 상태로 맵뷰에 add  
   - ImageView.load의 이미지 로드 상태 리스너에서 마커의 아이콘을 업데이트하는 콜백 실행  
2. **Compose-View 라이프사이클 동기화**  
   - DisposableEffect와 LifecycleObserver를 활용해 MapView와 Compose 생명주기를 통합 관리.  
   - onDispose에서 메모리 정리  

#### ✅ **결과**
- Coil로 Marker에 정상적으로 이미지 로딩.
- 마커의 이미지 로드 시작, 실패시 아이콘 변경
- Compose와 MapView를 안정적으로 통합 관리.  

#### 🌟 **배운 점 및 성장**
- **생명주기 관리 이해**: Compose와 View의 독립적 라이프사이클을 통합 관리하는 방법 학습.  
- **비동기 처리 최적화**: 정적인 UI와 비동기로 동작되는 UI의 연동방법 학습.
- **통합 관리 경험**: Compose와 기존 View를 함께 사용하는 기술적 자신감 확보.  


---
## 📔 문서

[Nature Album Wiki](https://github.com/boostcampwm-2024/and04-Nature-Album/wiki)에서 우리의 모든 여정을 확인하세요!  
아이디어부터 개발, 그리고 해결 과정까지, 모든 이야기가 담겨 있습니다. **궁금하시다면 지금 바로 확인해보세요!** 🚀
<br>

<img src="https://github.com/user-attachments/assets/2d1fa247-6d4f-43c5-9a9a-baa94b13a03d"/>

<br>

---

## 🧑‍🤝‍🧑 전국구 팀 구성

| <img src="https://avatars.githubusercontent.com/u/113690378?v=4" width="140"> | <img src="https://avatars.githubusercontent.com/u/87519273?v=4" width="140"> | <img src="https://avatars.githubusercontent.com/u/95901395?v=4" width="140"> | <img src="https://avatars.githubusercontent.com/u/113237390?v=4" width="140"> | <img src="https://avatars.githubusercontent.com/u/108558921?v=4" width="140"> |
| :--: | :--: | :--: | :--: | :--: |
| [정유진](https://github.com/yujin45) | [임형준](https://github.com/lh99j) | [김도윤](https://github.com/kimdoyun98) | [노진환](https://github.com/Jinhwan99) | [김정호](https://github.com/kim4152) |
